---
title: "defensive_model"
output: html_document
---

```{r}
df <- read.csv("../data/nba_processed.csv")


#Computing team's own points
df <- df %>%
  mutate(
    Points = Two.Pointers.Made * 2 + Three.Pointers.Made * 3 + Free.Throws.Made,
    Possessions = Two.Pointer.Attempts + Three.Pointers.Attempted + 0.44 * Free.Throws.Attempted - Offensive.Rebounds + Turnover
  )

#Creating clean opponent table
df_opp <- df %>%
  rename_with(~ paste0("Opp_", .), -Game.ID)

#Matching opponent's points by game ID
df_joined <- df %>%
  inner_join(df_opp, by = "Game.ID")%>%
  filter(Team.ID != Opp_Team.ID)

#Computing opponent's points
df_joined <- df_joined %>%
  mutate(
    OppPoints = Opp_Two.Pointers.Made * 2 + Opp_Three.Pointers.Made * 3 + Opp_Free.Throws.Made,
    OppPossessions = Opp_Two.Pointer.Attempts + Opp_Three.Pointers.Attempted + 0.44 * Opp_Free.Throws.Attempted - Opp_Offensive.Rebounds + Opp_Turnover,
    DefensiveEfficiency = OppPoints / OppPossessions
  )

#Selecting defensive variables
defense_data <- df_joined %>%
  select(
    DefensiveEfficiency,
    Defensive.Rebounds,
    Steals,
    Blocks,
    Blocks.Against,
    Personal.Fouls,
    Turnover,
    Total.Rebounds
  )
```


```{r}
#Fitting full defensive model
full_defensive_model <- lm(DefensiveEfficiency ~ ., data = defense_data)
summary(full_defensive_model)

```


```{r}
#Running backwards elimination
backward_defensive_model <- step(full_defensive_model, direction = "backward")
summary(backward_defensive_model)
backward_defensive_model$anova

```

