---
title: "offensive_model"
output: html_document
---

```{r}
source("../util/00_requirements.R")

df <- read.csv("../data/nba_processed.csv")


#Estimated Points scored
df <- df %>%
  mutate(
    Points = Two.Pointers.Made * 2 +
             Three.Pointers.Made * 3 +
             Free.Throws.Made
  )
#Estimated number of offensive possessions
df <- df %>%
  mutate(
    FG_Attempts_Total = Two.Pointer.Attempts + Three.Pointers.Attempted,
    Possessions = FG_Attempts_Total +
                  0.44 * Free.Throws.Attempted -
                  Offensive.Rebounds +
                  Turnover
  )
summary(df$Possessions)
# Estimated offensive efficiency
df <- df %>%
  mutate(
    OffensiveEfficiency = ifelse(Possessions <= 0, NA, Points / Possessions)
  )
summary(df$OffensiveEfficiency)

head(df[, c("Team.Name","Points", "Possessions", "OffensiveEfficiency")])

```
```{r}


#Forming offensive model
full_offensive_model <- lm(
  OffensiveEfficiency ~ Two.Pointer.Accuracy +
           Three.Pointer.Accuracy +
           Free.Throw.Accuracy +
           Offensive.Rebounds +
           Assists +
           Turnover +
           Two.Pointer.Attempts +
           Three.Pointers.Attempted +
           Free.Throws.Attempted,
  data = df
)

#Summary of the model
summary(full_offensive_model)
plot(full_offensive_model)


```
```{r}
vif(full_offensive_model)
resettest(full_offensive_model)

```
```{r}
par(mfrow=c(3,3))
for(col in c("Two.Pointer.Accuracy","Three.Pointer.Accuracy","Free.Throw.Accuracy",
             "Offensive.Rebounds","Assists","Turnover",
             "Two.Pointer.Attempts","Three.Pointers.Attempted","Free.Throws.Attempted")) {
  plot(df[[col]], residuals(full_offensive_model))
  main = col
  abline(h=0, col="red")
}
```

```{r}
#Running backwards elimination on the model
backward_offensive_model <- step(full_offensive_model, direction = "backward")
summary(backward_offensive_model)

#Running an f-test
anova(backward_offensive_model, full_offensive_model)
```

